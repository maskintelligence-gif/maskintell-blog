---
const { mode } = Astro.props; // "login" | "signup"
---

<form id="auth-form">
  <h1>{mode === "login" ? "Login" : "Sign Up"}</h1>

  <input
    type="email"
    name="email"
    placeholder="Email"
    required
  />

  <input
    type="password"
    name="password"
    placeholder="Password"
    required
  />

  <button type="submit">
    {mode === "login" ? "Login" : "Create account"}
  </button>

  <p id="error" class="error"></p>
</form>

<script type="module">
  import { supabase } from "/src/lib/supabase";

  const form = document.getElementById("auth-form");
  const errorEl = document.getElementById("error");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorEl.textContent = "";

    const email = form.email.value;
    const password = form.password.value;

    let result;

    if ("{mode}" === "login") {
      result = await supabase.auth.signInWithPassword({
        email,
        password
      });
    } else {
      result = await supabase.auth.signUp({
        email,
        password
      });
    }

    if (result.error) {
      errorEl.textContent = result.error.message;
    } else {
      window.location.href = "/dashboard";
    }
  });
</script>

<style>
form {
  max-width: 400px;
  margin: 3rem auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

input {
  padding: 0.75rem;
}

button {
  padding: 0.75rem;
  background: #2563eb;
  color: white;
  border: none;
  cursor: pointer;
}

.error {
  color: #ff6464;
}
</style>
