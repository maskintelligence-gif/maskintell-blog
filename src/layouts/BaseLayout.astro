---
/* =========================
   IMPORTS
========================= */
import "../styles/global.css";

/* =========================
   CMS SETTINGS
========================= */
import general from "../../content/settings/general.json";
import seo from "../../content/settings/seo.json";
import analytics from "../../content/settings/analytics.json";
import gdpr from "../../content/settings/gdpr.json";
import navigation from "../../content/settings/navigation.json";

/* =========================
   FALLBACKS
========================= */
const siteTitle = general.site_title ?? "MASK Intelligence";
const siteDescription =
  general.site_description ?? "Engineering intelligent digital systems.";

const metaTitle = seo.default_meta_title ?? siteTitle;
const metaDescription =
  seo.default_meta_description ?? siteDescription;

const metaImage = seo.default_meta_image ?? "";
const gaId = analytics.google_analytics_id ?? null;

/* GitHub Pages base-safe URL */
const base = Astro.site?.pathname ?? "/";
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- CORE META -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{metaTitle}</title>
    <meta name="description" content={metaDescription} />

    <!-- OPEN GRAPH -->
    <meta property="og:title" content={metaTitle} />
    <meta property="og:description" content={metaDescription} />
    <meta property="og:type" content="website" />
    {metaImage && <meta property="og:image" content={metaImage} />}

    <!-- TWITTER -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={metaTitle} />
    <meta name="twitter:description" content={metaDescription} />

    <!-- FAVICON -->
    {general.favicon && <link rel="icon" href={general.favicon} />}

    <!-- GOOGLE ANALYTICS -->
    {gaId && (
      <>
        <script
          async
          src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}
        ></script>
        <script is:inline>
          {`
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', '${gaId}');
          `}
        </script>
      </>
    )}
  </head>

  <body>
    <!-- HEADER -->
    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href={base}>
          {general.logo ? (
            <img src={general.logo} alt={siteTitle} />
          ) : (
            <span>{siteTitle}</span>
          )}
        </a>

        <nav class="main-nav">
          <ul>
            {navigation.main_menu?.map((item) => (
              <li>
                <a
                  href={`${base}${item.link.replace(/^\//, "")}`}
                  target={item.new_tab ? "_blank" : "_self"}
                  rel={item.new_tab ? "noopener noreferrer" : undefined}
                >
                  {item.label}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </div>
    </header>

    <!-- MAIN -->
    <main class="site-main">
      <slot />
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
      <div class="container footer-inner">
        <p>
          Â© {new Date().getFullYear()}{" "}
          {general.company_name ?? siteTitle}
        </p>

        <nav class="footer-nav">
          <ul>
            {navigation.footer_menu?.map((item) => (
              <li>
                <a href={`${base}${item.link.replace(/^\//, "")}`}>
                  {item.label}
                </a>
              </li>
            ))}
          </ul>
        </nav>

        <div class="legal">
          {gdpr.privacy_policy_url && (
            <a href={gdpr.privacy_policy_url}>Privacy Policy</a>
          )}
          {gdpr.terms_of_service_url && (
            <a href={gdpr.terms_of_service_url}>Terms of Service</a>
          )}
        </div>
      </div>
    </footer>
  </body>
</html>
