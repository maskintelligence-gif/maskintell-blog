---
import BaseLayout from "../../layouts/BaseLayout.astro";
import posts from "../../../content/posts";
import BlogCard from "../../components/BlogCard.astro";

const POSTS_PER_PAGE = 6;

export async function getStaticPaths() {
  const published = posts.filter(p => p.status === "published");

  const pages = Math.ceil(published.length / POSTS_PER_PAGE);

  return Array.from({ length: pages }).map((_, i) => ({
    params: { page: String(i + 1) },
  }));
}

const page = Number(Astro.params.page);
const start = (page - 1) * POSTS_PER_PAGE;
const paginated = posts
  .filter(p => p.status === "published")
  .slice(start, start + POSTS_PER_PAGE);
---

<BaseLayout title={`Blog – Page ${page}`}>

<section class="container">
  <h1>Blog</h1>

  <div class="grid">
    {paginated.map(post => (
      <BlogCard post={post} />
    ))}
  </div>

  <nav class="pagination">
    {page > 1 && <a href={`/blog/${page - 1}`}>← Prev</a>}
    <span>Page {page}</span>
    {paginated.length === POSTS_PER_PAGE && (
      <a href={`/blog/${page + 1}`}>Next →</a>
    )}
  </nav>
</section>

</BaseLayout>
